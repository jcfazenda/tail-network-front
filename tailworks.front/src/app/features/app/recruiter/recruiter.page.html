<section class="recruiter">
  <div class="recruiterInner recruiterContainer">

    <!-- TOPBAR -->
    <div class="recruiterTopbar">
      <div class="topbarLeft">
        <div class="miniTitle muted">Recruiter</div>
      </div>

      <div class="topbarRight">
        <button class="btn btn-primary" (click)="openCreateModal()">+ Criar Vaga</button>
      </div>
    </div>

    <!-- STATS -->
    <div class="statsCompact">
      <div class="statMini">
        <span class="muted">Ativas</span>
        <b>{{ activeJobs }}</b>
      </div>

      <div class="statMini">
        <span class="muted">Candidatos</span>
        <b>{{ totalApplicants }}</b>
      </div>

      <div class="statMini">
        <span class="muted">Encerradas</span>
        <b>{{ closedJobs }}</b>
      </div>
    </div>

    <!-- STATUS FILTER (Ãºnico filtro visÃ­vel da pÃ¡gina) -->
    <div class="statusSection">
      <div class="statusSectionDesktop">
        <div class="filters">
          <button class="pill" [class.active]="statusFilter === 'all'" (click)="setStatusFilter('all')">Todas</button>
          <button class="pill" [class.active]="statusFilter === 'aberta'" (click)="setStatusFilter('aberta')">Abertas</button>
          <button class="pill" [class.active]="statusFilter === 'pausada'" (click)="setStatusFilter('pausada')">Pausadas</button>
          <button class="pill" [class.active]="statusFilter === 'encerrada'" (click)="setStatusFilter('encerrada')">Encerradas</button>
        </div>
      </div>

      <div class="statusSectionMobile">
        <select class="input input--select" [(ngModel)]="statusFilter" aria-label="Status">
          <option value="all">Status: Todas</option>
          <option value="aberta">Status: Abertas</option>
          <option value="pausada">Status: Pausadas</option>
          <option value="encerrada">Status: Encerradas</option>
        </select>
      </div>
    </div>

    <!-- LIST -->
    <div class="jobsGrid">

      <div class="jobRow"
           *ngFor="let job of filteredJobs; trackBy: trackByJobId"
           [ngClass]="'accent-' + job.status"
           tabindex="0"
           role="button"
           (click)="openEditModal(job)"
           (keydown.enter)="openEditModal(job)"
           (keydown.space)="$event.preventDefault(); openEditModal(job)">

        <div class="jobMain">
          <div class="jobHeader">
            <div class="jobMetaLine">
              <span class="jobId muted">{{ formatJobDisplayId(job.id) }}</span>
              <span class="metaSep" aria-hidden="true">-</span>
              <span class="muted">{{ job.location }}</span>
              <span class="muted">({{ job.department }})</span>
            </div>

            <div class="jobTitleWrap">
              <h3 class="jobTitle">{{ job.title }}</h3>
              <span class="status" [ngClass]="job.status">{{ job.status }}</span>
            </div>
          </div>

          <div class="jobSub"> 
            <p class="jobDescription muted" *ngIf="job.description">{{ job.description }}</p>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="jobTools" (click)="$event.stopPropagation()">
          <div class="jobToolsLeft">
            <button class="avatarsBtn"
                    (click)="viewApplicants(job)"
                    aria-label="Ver candidatos"
                    title="Ver candidatos">
              <div class="avatars">
                <ng-container *ngFor="let t of (job.talents || []) | slice:0:4; trackBy: trackByTalentId">
                  <span
                    class="avatar"
                    [title]="t.name"
                    [style.background-image]="'url(' + (t.avatarUrl || avatarFallbackUrl) + ')'"
                  ></span>
                </ng-container>

                <span class="avatar avatar--more"
                      *ngIf="(job.talents?.length || 0) > 4">
                  +{{ (job.talents?.length || 0) - 4 }}
                </span>
              </div>
            </button>
          </div>

          <div class="jobToolsRight">
            <button class="iconBtn iconBtn--edit"
                    (click)="openEditModal(job)"
                    aria-label="Editar"
                    title="Editar">âœŽ</button>

            <button class="iconBtn iconBtn--chat"
                    (click)="toggleChat(job); $event.stopPropagation()"
                    aria-label="Chat"
                    title="Chat">ðŸ’¬</button>
          </div>
        </div>

      </div>

      <div class="emptyState card" *ngIf="filteredJobs.length === 0">
        <b>Nenhuma vaga encontrada</b>
        <p class="muted">Ajuste filtros ou crie uma nova vaga.</p>
        <button class="btn btn-primary" (click)="openCreateModal()">+ Criar Vaga</button>
      </div>

    </div>
  </div>

  <!-- CHAT DRAWER -->
  <recruiter-chat-drawer
    [isOpen]="isChatOpen"
    [job]="chatJob"
    [talents]="chatTalents"
    (close)="closeChat()">
  </recruiter-chat-drawer>
</section>
